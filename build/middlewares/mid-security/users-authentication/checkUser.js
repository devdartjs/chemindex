import jwt from"jsonwebtoken";import User from"../../../models/user-model.js";import{JWT_SECRET}from"../../../config/config-env.js";export const checkUser=async(e,r,s)=>{const o=e.cookies.jwt;if(!o)return r.locals.user=null,e.user=null,s();jwt.verify(o,JWT_SECRET,async(o,l)=>{if(o)return console.error("[checkUser] Invalid JWT:",o.message),r.locals.user=null,e.user=null,s();try{const o=await User.findById(l.id);return o?(r.locals.user=o,e.user=o,s()):(console.warn("[checkUser] No user found for decoded token."),r.locals.user=null,e.user=null,s())}catch(o){return console.error("[checkUser] Database error while fetching user:",o),r.locals.user=null,e.user=null,s()}})};