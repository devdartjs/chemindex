import{z}from"zod";import{Types}from"mongoose";import User from"../../../models/user-model.js";const updateUserParamsSchema=z.object({userId:z.string().refine(e=>Types.ObjectId.isValid(e),{message:"Invalid user ID"})}),updateUserBodySchema=z.object({email:z.string().email({message:"Invalid email format"}).optional(),password:z.string().min(6,{message:"Password must be at least 6 characters"}).optional()}).superRefine((e,s)=>{0===Object.keys(e).length&&s.addIssue({code:"custom",message:"No valid fields to update"})}),updateUser=async(e,s)=>{try{const{userId:r}=updateUserParamsSchema.parse(e.params),a=updateUserBodySchema.parse(e.body);a.email&&(a.email=a.email.trim().toLowerCase());const t=await User.findOneAndUpdate({_id:Types.ObjectId.createFromHexString(r),status:"user"},{$set:a},{new:!0,runValidators:!0});return t?s.status(200).json({updatedUser:t}):s.status(404).json({message:"User not found or not a regular user"})}catch(e){return e instanceof z.ZodError?s.status(400).json({errors:e.errors}):s.status(500).json({error:e.message})}};export default updateUser;