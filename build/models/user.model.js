import mongoose from"mongoose";import emailVal from"validator";import bcrypt from"bcryptjs";const{isEmail:isEmail}=emailVal,userSchema=mongoose.Schema({email:{type:String,required:[!0,"Please enter an email"],unique:!0,lowercase:!0,validate:[isEmail,"Please enter a valid email"]},password:{type:String,required:[!0,"Please enter a password"],minlength:[6,"Minimum password length is 6 characters"]},status:{type:String,enum:["user","user100","user250","user500","user750","user1000","userTest","admin"],default:"user"}});userSchema.index({status:1}),userSchema.pre("save",async function(e){const r=await bcrypt.genSalt();this.password=await bcrypt.hash(this.password,r),e()}),userSchema.post("save",function(e,r){r()}),userSchema.statics.login=async function(e,r){try{const s=await this.findOne({email:e});if(!s)throw new Error("incorrect email");if(await bcrypt.compare(r,s.password))return s;throw new Error("incorrect password")}catch(e){throw e}};const User=mongoose.model("user",userSchema);export default User;