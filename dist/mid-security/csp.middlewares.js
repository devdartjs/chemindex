import{PORT,NODE_ENV}from"../config/config.env.js";import generateNonce from"../utils/create-nonce.js";const cspMiddlewareDev=(e,t,c)=>{const o=generateNonce();t.locals.nonce=o;const n=generateCSPHeader({defaultSrc:["'self'"],scriptSrc:["'self'",`'nonce-${o}'`,`http://localhost:${PORT}`],styleSrc:["'self'",`'nonce-${o}'`,`http://localhost:${PORT}`,"https://fonts.gstatic.com"],objectSrc:["'none'"],imgSrc:["'self'","data:","https:",`http://localhost:${PORT}`],fontSrc:["'self'","https://fonts.gstatic.com"],connectSrc:["'self'",`http://localhost:${PORT}`],formAction:["'self'"],frameAncestors:["'none'"]});t.setHeader("Content-Security-Policy",n),c()},cspMiddlewareProd=(e,t,c)=>{const o=generateNonce();t.locals.nonce=o;const n={defaultSrc:["'self'"],scriptSrc:["'self'",`'nonce-${o}'`],styleSrc:["'self'",`'nonce-${o}'`],objectSrc:["'none'"],imgSrc:["'self'","data:","https:"],fontSrc:["'self'","https://fonts.gstatic.com"],connectSrc:["'self'"],formAction:["'self'"],frameAncestors:["'none'"]};t.setHeader("Content-Security-Policy",generateCSPHeader(n)),c()},generateCSPHeader=e=>Object.entries(e).map(([e,t])=>`${e} ${t.join(" ")}`).join("; "),cspMiddleware=(e,t,c)=>{const o=NODE_ENV;return"development"!==o?(t.locals.env=o,cspMiddlewareProd(0,t,c)):(t.locals.env=o,cspMiddlewareDev(0,t,c))};export default cspMiddleware;