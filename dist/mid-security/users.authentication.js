import jwt from"jsonwebtoken";import User from"../models/user.model.js";import{JWT_SECRET}from"../config/config.env.js";export const authentication=(e,o,r)=>{const s=e.cookies.jwt;console.log("authentication req-coockies-jwt Token:",s),s?jwt.verify(s,JWT_SECRET,(e,s)=>{if(e)return console.log("Error while verifying token:",e.message),o.redirect("/login");console.log("Token has been verified:",s),o.locals.user._id={_id:s.id},console.log("res.locals.userId-jwtMid:",o.locals.user._id),r()}):o.redirect("/login")};export const checkUser=async(e,o,r)=>{const s=e.cookies.jwt;if(!s)return o.locals.user=null,e.user=null,console.log("res.locals.user (error) = null"),r();jwt.verify(s,JWT_SECRET,async(s,l)=>{if(s)return console.log("Error while verifying token:",s.message),o.locals.user=null,e.user=null,r();try{const s=await User.findById(l.id);return o.locals.user=s,e.user=s,console.log("user was send to locals:",o.locals.user),r()}catch(s){return console.log("Error while searching user:",s.message),o.locals.user=null,e.user=null,r()}})};