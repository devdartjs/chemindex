import mongoose from"mongoose";import sanitizeHtml from"sanitize-html";const reagentSchema=mongoose.Schema({casNumber:{type:String,required:[!0,"CAS Number is required"],trim:!0},reagentName:{type:String,required:[!0,"Reagent name is required"]},description:{type:String,required:[!0,"description is required"]},classe:{type:String,required:[!0,"class is required"]},quantity:{type:Number,required:[!0,"Quantity is required"],min:[1,"Quantity must be at least 1"]},composition:[{substance:{type:String,required:!1},concentration:{type:String,required:!1}}],brand:{type:String,required:[!0,"brand is required"]},manufactureDate:{type:Date,required:[!1,"Manufacture date is required"]},expiryDate:{type:Date,required:[!1,"expire date is required"]},information:[String],classification:{type:String,required:[!0,"classification is required"]},local:{type:String,required:[!0,"Location is required"]},volume:{type:String,required:[!0,"volume is required"]},weight:{type:String,required:[!0,"Weight is required"]},molecularFormula:{type:String,required:[!0,"Molecular formula is required"]},molecularWeight_g_per_mol:{type:String,required:[!0,"Molecular weight is required"]},furtherInformations:{type:String,default:""},createdBy:{type:mongoose.Schema.Types.ObjectId,ref:"user",required:!1}});reagentSchema.index({casNumber:1,createdBy:1},{unique:!0}),reagentSchema.pre("save",function(e){this.casNumber=sanitizeHtml(this.casNumber,{allowedTags:[],allowedAttributes:{}}),this.reagentName=sanitizeHtml(this.reagentName,{allowedTags:[],allowedAttributes:{}}),this.description=sanitizeHtml(this.description,{allowedTags:[],allowedAttributes:{}}),this.classe=sanitizeHtml(this.classe,{allowedTags:[],allowedAttributes:{}}),this.brand=sanitizeHtml(this.brand,{allowedTags:[],allowedAttributes:{}}),this.classification=sanitizeHtml(this.classification,{allowedTags:[],allowedAttributes:{}}),this.local=sanitizeHtml(this.local,{allowedTags:[],allowedAttributes:{}}),this.composition&&Array.isArray(this.composition)&&(this.composition=this.composition.map(e=>(e.substance=sanitizeHtml(e.substance,{allowedTags:[],allowedAttributes:{}}),e.concentration=sanitizeHtml(e.concentration,{allowedTags:[],allowedAttributes:{}}),delete e._id,e))),this.information=this.information.map(e=>sanitizeHtml(e,{allowedTags:[],allowedAttributes:{}})),this.volume=sanitizeHtml(this.volume,{allowedTags:[],allowedAttributes:{}}),this.weight=sanitizeHtml(this.weight,{allowedTags:[],allowedAttributes:{}}),this.molecularFormula=sanitizeHtml(this.molecularFormula,{allowedTags:[],allowedAttributes:{}}),this.molecularWeight_g_per_mol=sanitizeHtml(this.molecularWeight_g_per_mol,{allowedTags:[],allowedAttributes:{}}),this.furtherInformations=sanitizeHtml(this.furtherInformations,{allowedTags:[],allowedAttributes:{}}),console.log("Reagent about to be created & saved",this),e()}),reagentSchema.post("save",function(e,t){console.log("A reagent was created",e),t()});const Reagent=mongoose.model("Reagent",reagentSchema);export default Reagent;