import User from"../models/user.model.js";import{handleErrors}from"../mid-functions/error.handler.js";import createToken from"../mid-functions/creat.token.js";export const signUp=async(r,s)=>{const{email:e,password:o}=r.body;try{const r=await User.create({email:e,password:o}),t=createToken(r._id);s.cookie("jwt",t,{httpOnly:!0,maxAge:864e5}),s.status(201).json({user:r})}catch(r){if(11e3===r.code)return s.status(400).json({errors:{email:"That email is already used!"}});const e=handleErrors(r);s.status(400).json({errors:e})}};export const login=async(r,s)=>{const{email:e,password:o}=r.body;try{const r=await User.login(e,o);if(r){const e=createToken(r._id);return s.cookie("jwt",e,{httpOnly:!0,maxAge:864e5}),s.status(200).json({user:r,token:e,nonce:s.locals.nonce})}throw new Error("incorrect password")}catch(r){const e=handleErrors(r);if("incorrect email"===r.message)return s.status(400).json({errors:{email:e.email}});if("incorrect password"===r.message)return s.status(400).json({errors:{password:e.password}})}};